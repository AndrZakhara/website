/*!
 * website
 * Fiercely quick and opinionated front-ends
 * 
 * @author Andr Zakhar
 * @version 1.0.0
 * Copyright 2018. MIT licensed.
 */
/*!
 * website
 * Fiercely quick and opinionated front-ends
 * 
 * @author Andr Zakhar
 * @version 1.0.0
 * Copyright 2018. MIT licensed.
 */
(function () {
  let inputValue = '',
    selectedElement = '',
    previousNode = '',
    nextNode = '',
    parentNode = '',
    childrenNode = '';

  function createApp() {
    const inputSearch = createElement('input', {className: 'search-input', type: 'text', placeholder: 'Selector'});
    const btnSearch = createElement('input', {className: 'search-btn', type: 'button', value: 'search'});

    const btnPrev = createElement('input', {className: 'prev-btn', type: 'button', value: 'Prev'});
    const btnNext = createElement('input', {className: 'next-btn', type: 'button', value: 'Next'});
    const btnParent = createElement('input', {className: 'parent-btn', type: 'button', value: 'Parent'});
    const btnChildren = createElement('input', {className: 'children-btn', type: 'button', value: 'Children'});

    const btnClose = createElement('input', {className: 'close-btn', type: 'button', value: 'x'});

    const textFieldWrapper = createElement('div', {className: 'text-field-wrapper'}, inputSearch, btnSearch);
    const btnWrapper = createElement('div', {className: 'btn-wrapper'}, btnPrev, btnNext, btnParent, btnChildren, btnClose);

    const mainAppWrapper = createElement('div', {className: 'search-app-wrapper'}, textFieldWrapper, btnWrapper);

    btnSearch.disabled = true;
    btnPrev.disabled = true;
    btnNext.disabled = true;
    btnParent.disabled = true;
    btnChildren.disabled = true;

    btnSearch.addEventListener('click', handleSearch);
    inputSearch.addEventListener('input', handleInput);
    btnParent.addEventListener('click', handleParent);
    btnChildren.addEventListener('click', handleChildren);
    btnNext.addEventListener('click', handleNext);
    btnPrev.addEventListener('click', handlePrevious);
    btnClose.addEventListener('click', handleClose);

    document.body.insertAdjacentElement('beforeend', mainAppWrapper);

    dragBlock('.search-app-wrapper');
  }

  const handleSearch = () => {
    inputValue = document.querySelector('.search-input').value;
    document.querySelector('.search-input').value = '';
    document.querySelector('.search-btn').disabled = true;

    try {
      if (selectedElement === '') {
        const selected = document.querySelector(inputValue);

        if (selected !== undefined && selected !== null) {
          selectedElement = selected;
          selectedElement.classList.add('selected-element-search');
          findRelative(selectedElement);
        }
      }
      else if (selectedElement !== null || selectedElement !== undefined) {
        selectedElement.classList.remove('selected-element-search');
        const selected = document.querySelector(inputValue);

        if (selected !== undefined && selected !== null) {
          selectedElement = selected;
          selectedElement.classList.add('selected-element-search');
          findRelative(selectedElement);
        }
      }
    }
    catch (err) {
      document.querySelector('.search-btn').disabled = true;
      document.querySelector('.prev-btn').disabled = true;
      document.querySelector('.next-btn').disabled = true;
      document.querySelector('.parent-btn').disabled = true;
      document.querySelector('.children-btn').disabled = true;
    }

    document.querySelector('.search-btn').disabled = true;

    scrollToElement('.selected-element-search');
  };

  const handleInput = (e) => {
    (e.target.value === '')
      ? document.querySelector('.search-btn').disabled = true
      : document.querySelector('.search-btn').disabled = false
  };

  const handleParent = () => {
    helperForHandler(parentNode);
  };

  const handleChildren = () => {
    helperForHandler(childrenNode);
  };

  const handleNext = () => {
    helperForHandler(nextNode);
  };

  const handlePrevious = () => {
    helperForHandler(previousNode);
  };

  const handleClose = () => {
    document.querySelector('.search-app-wrapper').remove();
    selectedElement !== '' ? selectedElement.classList.remove('selected-element-search') : false;
  };

  const helperForHandler = (newSelected) => {
    selectedElement.classList.remove('selected-element-search');
    selectedElement = newSelected;
    selectedElement.classList.add('selected-element-search');

    findRelative(selectedElement);
    scrollToElement('.selected-element-search');
  };

  function scrollToElement(theElement) {
    let selectedPosX = 0;
    let selectedPosY = 0;

    if (typeof theElement === "string") theElement = document.querySelector(theElement);

    while (theElement !== null) {
      selectedPosX += theElement.offsetLeft;
      selectedPosY += theElement.offsetTop;
      theElement = theElement.offsetParent;
    }

    selectedPosY = selectedPosY - 20;
    window.scrollTo(selectedPosX, selectedPosY);
  }

  function findRelative(element) {
    const tagNameParent = element.parentNode.tagName;
    const child = element.children[0];

    if (
      element.parentNode !== undefined
      // && tagNameParent !== 'BODY'
      && tagNameParent !== 'HTML'
      && tagNameParent !== 'document'
      && tagNameParent !== undefined
    ) {
      document.querySelector('.parent-btn').disabled = false;
      parentNode = element.parentNode;
    }
    else {
      document.querySelector('.parent-btn').disabled = true;
      parentNode = '';
    }

    if (child !== undefined) {
      document.querySelector('.children-btn').disabled = false;
      childrenNode = child;
    }
    else {
      document.querySelector('.children-btn').disabled = true;
      childrenNode = '';
    }

    siblingArr = [].slice.call(element.parentNode.children);

    if (siblingArr.length > 1) {
      siblingArr.forEach((item, index, arr) => {

        if (item.classList.contains('selected-element-search')) {

          if (index >= 1) {
            previousNode = arr[index - 1];
            document.querySelector('.prev-btn').disabled = false;
          } else {
            previousNode = '';
            document.querySelector('.prev-btn').disabled = true;
          }

          if (index === arr.length - 1) {
            nextNode = '';
            document.querySelector('.next-btn').disabled = true;
          } else {
            nextNode = arr[index + 1];
            document.querySelector('.next-btn').disabled = false;
          }
        }
      })
    } else {
      previousNode = '';
      document.querySelector('.prev-btn').disabled = true;
      document.querySelector('.next-btn').disabled = true;
    }
  }

  function dragBlock(selector) {
    let el = document.querySelector(selector);
    el.ondragstart = function() {
      return false;
    };

    el.onmousedown = function(e) {

      el.style.position = 'absolute';
      moveAt(e);
      document.body.appendChild(el);

      el.style.zIndex = 1000;

      function moveAt(e) {
        el.style.left = e.pageX - el.offsetWidth / 2 + 'px';
        el.style.top = e.pageY - el.offsetHeight / 2 + 'px';
      }

      document.onmousemove = function(e) {
        moveAt(e);
      };

      el.onmouseup = function() {
        document.onmousemove = null;
        el.onmouseup = null;
      }
    }
  }

  function createElement(tag, props, ...children) {
    const element = document.createElement(tag);

    Object.keys(props).forEach(key => (element[key] = props[key]));

    children.forEach(child => {

      if (typeof child === "string") {
        child = document.createTextNode(child);
      }

      element.appendChild(child);
    });

    return element;
  }

  document.addEventListener("DOMContentLoaded", createApp);
}());

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdHMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJzY3JpcHRzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XHJcbiAgbGV0IGlucHV0VmFsdWUgPSAnJyxcclxuICAgIHNlbGVjdGVkRWxlbWVudCA9ICcnLFxyXG4gICAgcHJldmlvdXNOb2RlID0gJycsXHJcbiAgICBuZXh0Tm9kZSA9ICcnLFxyXG4gICAgcGFyZW50Tm9kZSA9ICcnLFxyXG4gICAgY2hpbGRyZW5Ob2RlID0gJyc7XHJcblxyXG4gIGZ1bmN0aW9uIGNyZWF0ZUFwcCgpIHtcclxuICAgIGNvbnN0IGlucHV0U2VhcmNoID0gY3JlYXRlRWxlbWVudCgnaW5wdXQnLCB7Y2xhc3NOYW1lOiAnc2VhcmNoLWlucHV0JywgdHlwZTogJ3RleHQnLCBwbGFjZWhvbGRlcjogJ1NlbGVjdG9yJ30pO1xyXG4gICAgY29uc3QgYnRuU2VhcmNoID0gY3JlYXRlRWxlbWVudCgnaW5wdXQnLCB7Y2xhc3NOYW1lOiAnc2VhcmNoLWJ0bicsIHR5cGU6ICdidXR0b24nLCB2YWx1ZTogJ3NlYXJjaCd9KTtcclxuXHJcbiAgICBjb25zdCBidG5QcmV2ID0gY3JlYXRlRWxlbWVudCgnaW5wdXQnLCB7Y2xhc3NOYW1lOiAncHJldi1idG4nLCB0eXBlOiAnYnV0dG9uJywgdmFsdWU6ICdQcmV2J30pO1xyXG4gICAgY29uc3QgYnRuTmV4dCA9IGNyZWF0ZUVsZW1lbnQoJ2lucHV0Jywge2NsYXNzTmFtZTogJ25leHQtYnRuJywgdHlwZTogJ2J1dHRvbicsIHZhbHVlOiAnTmV4dCd9KTtcclxuICAgIGNvbnN0IGJ0blBhcmVudCA9IGNyZWF0ZUVsZW1lbnQoJ2lucHV0Jywge2NsYXNzTmFtZTogJ3BhcmVudC1idG4nLCB0eXBlOiAnYnV0dG9uJywgdmFsdWU6ICdQYXJlbnQnfSk7XHJcbiAgICBjb25zdCBidG5DaGlsZHJlbiA9IGNyZWF0ZUVsZW1lbnQoJ2lucHV0Jywge2NsYXNzTmFtZTogJ2NoaWxkcmVuLWJ0bicsIHR5cGU6ICdidXR0b24nLCB2YWx1ZTogJ0NoaWxkcmVuJ30pO1xyXG5cclxuICAgIGNvbnN0IGJ0bkNsb3NlID0gY3JlYXRlRWxlbWVudCgnaW5wdXQnLCB7Y2xhc3NOYW1lOiAnY2xvc2UtYnRuJywgdHlwZTogJ2J1dHRvbicsIHZhbHVlOiAneCd9KTtcclxuXHJcbiAgICBjb25zdCB0ZXh0RmllbGRXcmFwcGVyID0gY3JlYXRlRWxlbWVudCgnZGl2Jywge2NsYXNzTmFtZTogJ3RleHQtZmllbGQtd3JhcHBlcid9LCBpbnB1dFNlYXJjaCwgYnRuU2VhcmNoKTtcclxuICAgIGNvbnN0IGJ0bldyYXBwZXIgPSBjcmVhdGVFbGVtZW50KCdkaXYnLCB7Y2xhc3NOYW1lOiAnYnRuLXdyYXBwZXInfSwgYnRuUHJldiwgYnRuTmV4dCwgYnRuUGFyZW50LCBidG5DaGlsZHJlbiwgYnRuQ2xvc2UpO1xyXG5cclxuICAgIGNvbnN0IG1haW5BcHBXcmFwcGVyID0gY3JlYXRlRWxlbWVudCgnZGl2Jywge2NsYXNzTmFtZTogJ3NlYXJjaC1hcHAtd3JhcHBlcid9LCB0ZXh0RmllbGRXcmFwcGVyLCBidG5XcmFwcGVyKTtcclxuXHJcbiAgICBidG5TZWFyY2guZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgYnRuUHJldi5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICBidG5OZXh0LmRpc2FibGVkID0gdHJ1ZTtcclxuICAgIGJ0blBhcmVudC5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICBidG5DaGlsZHJlbi5kaXNhYmxlZCA9IHRydWU7XHJcblxyXG4gICAgYnRuU2VhcmNoLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlU2VhcmNoKTtcclxuICAgIGlucHV0U2VhcmNoLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgaGFuZGxlSW5wdXQpO1xyXG4gICAgYnRuUGFyZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlUGFyZW50KTtcclxuICAgIGJ0bkNoaWxkcmVuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlQ2hpbGRyZW4pO1xyXG4gICAgYnRuTmV4dC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZU5leHQpO1xyXG4gICAgYnRuUHJldi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZVByZXZpb3VzKTtcclxuICAgIGJ0bkNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlQ2xvc2UpO1xyXG5cclxuICAgIGRvY3VtZW50LmJvZHkuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdiZWZvcmVlbmQnLCBtYWluQXBwV3JhcHBlcik7XHJcblxyXG4gICAgZHJhZ0Jsb2NrKCcuc2VhcmNoLWFwcC13cmFwcGVyJyk7XHJcbiAgfVxyXG5cclxuICBjb25zdCBoYW5kbGVTZWFyY2ggPSAoKSA9PiB7XHJcbiAgICBpbnB1dFZhbHVlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNlYXJjaC1pbnB1dCcpLnZhbHVlO1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNlYXJjaC1pbnB1dCcpLnZhbHVlID0gJyc7XHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2VhcmNoLWJ0bicpLmRpc2FibGVkID0gdHJ1ZTtcclxuXHJcbiAgICB0cnkge1xyXG4gICAgICBpZiAoc2VsZWN0ZWRFbGVtZW50ID09PSAnJykge1xyXG4gICAgICAgIGNvbnN0IHNlbGVjdGVkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihpbnB1dFZhbHVlKTtcclxuXHJcbiAgICAgICAgaWYgKHNlbGVjdGVkICE9PSB1bmRlZmluZWQgJiYgc2VsZWN0ZWQgIT09IG51bGwpIHtcclxuICAgICAgICAgIHNlbGVjdGVkRWxlbWVudCA9IHNlbGVjdGVkO1xyXG4gICAgICAgICAgc2VsZWN0ZWRFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkLWVsZW1lbnQtc2VhcmNoJyk7XHJcbiAgICAgICAgICBmaW5kUmVsYXRpdmUoc2VsZWN0ZWRFbGVtZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSBpZiAoc2VsZWN0ZWRFbGVtZW50ICE9PSBudWxsIHx8IHNlbGVjdGVkRWxlbWVudCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgc2VsZWN0ZWRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkLWVsZW1lbnQtc2VhcmNoJyk7XHJcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGlucHV0VmFsdWUpO1xyXG5cclxuICAgICAgICBpZiAoc2VsZWN0ZWQgIT09IHVuZGVmaW5lZCAmJiBzZWxlY3RlZCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgc2VsZWN0ZWRFbGVtZW50ID0gc2VsZWN0ZWQ7XHJcbiAgICAgICAgICBzZWxlY3RlZEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnc2VsZWN0ZWQtZWxlbWVudC1zZWFyY2gnKTtcclxuICAgICAgICAgIGZpbmRSZWxhdGl2ZShzZWxlY3RlZEVsZW1lbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGVycikge1xyXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2VhcmNoLWJ0bicpLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByZXYtYnRuJykuZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubmV4dC1idG4nKS5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wYXJlbnQtYnRuJykuZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2hpbGRyZW4tYnRuJykuZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZWFyY2gtYnRuJykuZGlzYWJsZWQgPSB0cnVlO1xyXG5cclxuICAgIHNjcm9sbFRvRWxlbWVudCgnLnNlbGVjdGVkLWVsZW1lbnQtc2VhcmNoJyk7XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgaGFuZGxlSW5wdXQgPSAoZSkgPT4ge1xyXG4gICAgKGUudGFyZ2V0LnZhbHVlID09PSAnJylcclxuICAgICAgPyBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2VhcmNoLWJ0bicpLmRpc2FibGVkID0gdHJ1ZVxyXG4gICAgICA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZWFyY2gtYnRuJykuZGlzYWJsZWQgPSBmYWxzZVxyXG4gIH07XHJcblxyXG4gIGNvbnN0IGhhbmRsZVBhcmVudCA9ICgpID0+IHtcclxuICAgIGhlbHBlckZvckhhbmRsZXIocGFyZW50Tm9kZSk7XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgaGFuZGxlQ2hpbGRyZW4gPSAoKSA9PiB7XHJcbiAgICBoZWxwZXJGb3JIYW5kbGVyKGNoaWxkcmVuTm9kZSk7XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgaGFuZGxlTmV4dCA9ICgpID0+IHtcclxuICAgIGhlbHBlckZvckhhbmRsZXIobmV4dE5vZGUpO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGhhbmRsZVByZXZpb3VzID0gKCkgPT4ge1xyXG4gICAgaGVscGVyRm9ySGFuZGxlcihwcmV2aW91c05vZGUpO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGhhbmRsZUNsb3NlID0gKCkgPT4ge1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNlYXJjaC1hcHAtd3JhcHBlcicpLnJlbW92ZSgpO1xyXG4gICAgc2VsZWN0ZWRFbGVtZW50ICE9PSAnJyA/IHNlbGVjdGVkRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3RlZC1lbGVtZW50LXNlYXJjaCcpIDogZmFsc2U7XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgaGVscGVyRm9ySGFuZGxlciA9IChuZXdTZWxlY3RlZCkgPT4ge1xyXG4gICAgc2VsZWN0ZWRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkLWVsZW1lbnQtc2VhcmNoJyk7XHJcbiAgICBzZWxlY3RlZEVsZW1lbnQgPSBuZXdTZWxlY3RlZDtcclxuICAgIHNlbGVjdGVkRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZC1lbGVtZW50LXNlYXJjaCcpO1xyXG5cclxuICAgIGZpbmRSZWxhdGl2ZShzZWxlY3RlZEVsZW1lbnQpO1xyXG4gICAgc2Nyb2xsVG9FbGVtZW50KCcuc2VsZWN0ZWQtZWxlbWVudC1zZWFyY2gnKTtcclxuICB9O1xyXG5cclxuICBmdW5jdGlvbiBzY3JvbGxUb0VsZW1lbnQodGhlRWxlbWVudCkge1xyXG4gICAgbGV0IHNlbGVjdGVkUG9zWCA9IDA7XHJcbiAgICBsZXQgc2VsZWN0ZWRQb3NZID0gMDtcclxuXHJcbiAgICBpZiAodHlwZW9mIHRoZUVsZW1lbnQgPT09IFwic3RyaW5nXCIpIHRoZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoZUVsZW1lbnQpO1xyXG5cclxuICAgIHdoaWxlICh0aGVFbGVtZW50ICE9PSBudWxsKSB7XHJcbiAgICAgIHNlbGVjdGVkUG9zWCArPSB0aGVFbGVtZW50Lm9mZnNldExlZnQ7XHJcbiAgICAgIHNlbGVjdGVkUG9zWSArPSB0aGVFbGVtZW50Lm9mZnNldFRvcDtcclxuICAgICAgdGhlRWxlbWVudCA9IHRoZUVsZW1lbnQub2Zmc2V0UGFyZW50O1xyXG4gICAgfVxyXG5cclxuICAgIHNlbGVjdGVkUG9zWSA9IHNlbGVjdGVkUG9zWSAtIDIwO1xyXG4gICAgd2luZG93LnNjcm9sbFRvKHNlbGVjdGVkUG9zWCwgc2VsZWN0ZWRQb3NZKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGZpbmRSZWxhdGl2ZShlbGVtZW50KSB7XHJcbiAgICBjb25zdCB0YWdOYW1lUGFyZW50ID0gZWxlbWVudC5wYXJlbnROb2RlLnRhZ05hbWU7XHJcbiAgICBjb25zdCBjaGlsZCA9IGVsZW1lbnQuY2hpbGRyZW5bMF07XHJcblxyXG4gICAgaWYgKFxyXG4gICAgICBlbGVtZW50LnBhcmVudE5vZGUgIT09IHVuZGVmaW5lZFxyXG4gICAgICAvLyAmJiB0YWdOYW1lUGFyZW50ICE9PSAnQk9EWSdcclxuICAgICAgJiYgdGFnTmFtZVBhcmVudCAhPT0gJ0hUTUwnXHJcbiAgICAgICYmIHRhZ05hbWVQYXJlbnQgIT09ICdkb2N1bWVudCdcclxuICAgICAgJiYgdGFnTmFtZVBhcmVudCAhPT0gdW5kZWZpbmVkXHJcbiAgICApIHtcclxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBhcmVudC1idG4nKS5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICBwYXJlbnROb2RlID0gZWxlbWVudC5wYXJlbnROb2RlO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wYXJlbnQtYnRuJykuZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICBwYXJlbnROb2RlID0gJyc7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGNoaWxkICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNoaWxkcmVuLWJ0bicpLmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgIGNoaWxkcmVuTm9kZSA9IGNoaWxkO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jaGlsZHJlbi1idG4nKS5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgIGNoaWxkcmVuTm9kZSA9ICcnO1xyXG4gICAgfVxyXG5cclxuICAgIHNpYmxpbmdBcnIgPSBbXS5zbGljZS5jYWxsKGVsZW1lbnQucGFyZW50Tm9kZS5jaGlsZHJlbik7XHJcblxyXG4gICAgaWYgKHNpYmxpbmdBcnIubGVuZ3RoID4gMSkge1xyXG4gICAgICBzaWJsaW5nQXJyLmZvckVhY2goKGl0ZW0sIGluZGV4LCBhcnIpID0+IHtcclxuXHJcbiAgICAgICAgaWYgKGl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWxlY3RlZC1lbGVtZW50LXNlYXJjaCcpKSB7XHJcblxyXG4gICAgICAgICAgaWYgKGluZGV4ID49IDEpIHtcclxuICAgICAgICAgICAgcHJldmlvdXNOb2RlID0gYXJyW2luZGV4IC0gMV07XHJcbiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcmV2LWJ0bicpLmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBwcmV2aW91c05vZGUgPSAnJztcclxuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByZXYtYnRuJykuZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIGlmIChpbmRleCA9PT0gYXJyLmxlbmd0aCAtIDEpIHtcclxuICAgICAgICAgICAgbmV4dE5vZGUgPSAnJztcclxuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5leHQtYnRuJykuZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbmV4dE5vZGUgPSBhcnJbaW5kZXggKyAxXTtcclxuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5leHQtYnRuJykuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBwcmV2aW91c05vZGUgPSAnJztcclxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByZXYtYnRuJykuZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubmV4dC1idG4nKS5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBkcmFnQmxvY2soc2VsZWN0b3IpIHtcclxuICAgIGxldCBlbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpO1xyXG4gICAgZWwub25kcmFnc3RhcnQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfTtcclxuXHJcbiAgICBlbC5vbm1vdXNlZG93biA9IGZ1bmN0aW9uKGUpIHtcclxuXHJcbiAgICAgIGVsLnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcclxuICAgICAgbW92ZUF0KGUpO1xyXG4gICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsKTtcclxuXHJcbiAgICAgIGVsLnN0eWxlLnpJbmRleCA9IDEwMDA7XHJcblxyXG4gICAgICBmdW5jdGlvbiBtb3ZlQXQoZSkge1xyXG4gICAgICAgIGVsLnN0eWxlLmxlZnQgPSBlLnBhZ2VYIC0gZWwub2Zmc2V0V2lkdGggLyAyICsgJ3B4JztcclxuICAgICAgICBlbC5zdHlsZS50b3AgPSBlLnBhZ2VZIC0gZWwub2Zmc2V0SGVpZ2h0IC8gMiArICdweCc7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGRvY3VtZW50Lm9ubW91c2Vtb3ZlID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgIG1vdmVBdChlKTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGVsLm9ubW91c2V1cCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGRvY3VtZW50Lm9ubW91c2Vtb3ZlID0gbnVsbDtcclxuICAgICAgICBlbC5vbm1vdXNldXAgPSBudWxsO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBjcmVhdGVFbGVtZW50KHRhZywgcHJvcHMsIC4uLmNoaWxkcmVuKSB7XHJcbiAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xyXG5cclxuICAgIE9iamVjdC5rZXlzKHByb3BzKS5mb3JFYWNoKGtleSA9PiAoZWxlbWVudFtrZXldID0gcHJvcHNba2V5XSkpO1xyXG5cclxuICAgIGNoaWxkcmVuLmZvckVhY2goY2hpbGQgPT4ge1xyXG5cclxuICAgICAgaWYgKHR5cGVvZiBjaGlsZCA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgIGNoaWxkID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoY2hpbGQpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBlbGVtZW50LmFwcGVuZENoaWxkKGNoaWxkKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBlbGVtZW50O1xyXG4gIH1cclxuXHJcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgY3JlYXRlQXBwKTtcclxufSgpKTtcclxuIl19
