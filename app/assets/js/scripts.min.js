/*!
 * website
 * Fiercely quick and opinionated front-ends
 * 
 * @author Andr Zakhar
 * @version 1.0.0
 * Copyright 2018. MIT licensed.
 */
/*!
 * website
 * Fiercely quick and opinionated front-ends
 * 
 * @author Andr Zakhar
 * @version 1.0.0
 * Copyright 2018. MIT licensed.
 */
(function () {
  let inputValue = '',
    selectedElement = '',
    previousNode = '',
    nextNode = '',
    parentNode = '',
    childrenNode = '';

  function createApp() {
    const inputSearch = createElement('input', {className: 'search-input', type: 'text', placeholder: 'Selector'});
    const btnSearch = createElement('input', {className: 'search-btn', type: 'button', value: 'search'});

    const btnPrev = createElement('input', {className: 'prev-btn', type: 'button', value: 'Prev'});
    const btnNext = createElement('input', {className: 'next-btn', type: 'button', value: 'Next'});
    const btnParent = createElement('input', {className: 'parent-btn', type: 'button', value: 'Parent'});
    const btnChildren = createElement('input', {className: 'children-btn', type: 'button', value: 'Children'});
    const btnClose = createElement('input', {className: 'close-btn', type: 'button', value: 'x'});

    const textFieldWrapper = createElement('div', {className: 'text-field-wrapper'}, inputSearch, btnSearch);
    const btnWrapper = createElement('div', {className: 'btn-wrapper'}, btnPrev, btnNext, btnParent, btnChildren, btnClose);

    const mainAppWrapper = createElement('div', {className: 'search-app-wrapper'}, textFieldWrapper, btnWrapper);

    btnSearch.disabled = true;
    btnPrev.disabled = true;
    btnNext.disabled = true;
    btnParent.disabled = true;
    btnChildren.disabled = true;

    btnSearch.addEventListener('click', handleSearch);
    inputSearch.addEventListener('input', handleInput);
    btnParent.addEventListener('click', handleParent);
    btnChildren.addEventListener('click', handleChildren);
    btnNext.addEventListener('click', handleNext);
    btnPrev.addEventListener('click', handlePrevious);
    btnClose.addEventListener('click', handleClose);

    document.body.insertAdjacentElement('beforeend', mainAppWrapper);

    dragBlock('.search-app-wrapper');
  }

  const handleSearch = () => {
    inputValue = document.querySelector('.search-input').value;
    document.querySelector('.search-input').value = '';
    document.querySelector('.search-btn').disabled = true;

    try {
      if (selectedElement === '') {
        const selected = document.querySelector(inputValue);

        if (selected !== undefined && selected !== null) {
          selectedElement = selected;
          selectedElement.classList.add('selected-element-search');
          findRelative(selectedElement);
        }
      }
      else if (selectedElement !== null || selectedElement !== undefined) {
        selectedElement.classList.remove('selected-element-search');
        const selected = document.querySelector(inputValue);

        if (selected !== undefined && selected !== null) {
          selectedElement = selected;
          selectedElement.classList.add('selected-element-search');
          findRelative(selectedElement);
        }
      }
    }
    catch (err) {
      document.querySelector('.search-btn').disabled = true;
      document.querySelector('.prev-btn').disabled = true;
      document.querySelector('.next-btn').disabled = true;
      document.querySelector('.parent-btn').disabled = true;
      document.querySelector('.children-btn').disabled = true;
    }

    document.querySelector('.search-btn').disabled = true;

    scrollToElement('.selected-element-search');
  };

  const handleInput = (e) => {
    (e.target.value === '')
      ? document.querySelector('.search-btn').disabled = true
      : document.querySelector('.search-btn').disabled = false
  };

  const handleParent = () => {
    helperForHandler(parentNode);
  };

  const handleChildren = () => {
    helperForHandler(childrenNode);
  };

  const handleNext = () => {
    helperForHandler(nextNode);
  };

  const handlePrevious = () => {
    helperForHandler(previousNode);
  };

  const handleClose = () => {
    el = '';
    document.querySelector('.search-app-wrapper').remove();
    selectedElement !== '' ? selectedElement.classList.remove('selected-element-search') : false;
  };

  const helperForHandler = (newSelected) => {
    selectedElement.classList.remove('selected-element-search');
    selectedElement = newSelected;
    selectedElement.classList.add('selected-element-search');

    findRelative(selectedElement);
    scrollToElement('.selected-element-search');
  };

  function scrollToElement(theElement) {
    let selectedPosX = 0;
    let selectedPosY = 0;

    if (typeof theElement === "string") theElement = document.querySelector(theElement);

    while (theElement !== null) {
      selectedPosX += theElement.offsetLeft;
      selectedPosY += theElement.offsetTop;
      theElement = theElement.offsetParent;
    }

    selectedPosY = selectedPosY - 20;
    window.scrollTo(selectedPosX, selectedPosY);
  }

  function findRelative(element) {
    const tagNameParent = element.parentNode.tagName.toLowerCase();
    const child = element.children[0];
    console.log(tagNameParent);
    if (
      element.parentNode !== undefined
      && tagNameParent !== 'body'
      && tagNameParent !== 'html'
      && tagNameParent !== 'document'
      && tagNameParent !== undefined
    ) {
      document.querySelector('.parent-btn').disabled = false;
      parentNode = element.parentNode;
    }
    else {
      document.querySelector('.parent-btn').disabled = true;
      parentNode = '';
    }

    if (child !== undefined) {
      document.querySelector('.children-btn').disabled = false;
      childrenNode = child;
    }
    else {
      document.querySelector('.children-btn').disabled = true;
      childrenNode = '';
    }

    siblingArr = [].slice.call(element.parentNode.children);

    if (siblingArr.length > 1) {
      siblingArr.forEach((item, index, arr) => {

        if (item.classList.contains('selected-element-search')) {

          if (index >= 1) {
            previousNode = arr[index - 1];
            document.querySelector('.prev-btn').disabled = false;
          } else {
            previousNode = '';
            document.querySelector('.prev-btn').disabled = true;
          }

          if (index === arr.length - 1) {
            nextNode = '';
            document.querySelector('.next-btn').disabled = true;
          } else {
            nextNode = arr[index + 1];
            document.querySelector('.next-btn').disabled = false;
          }
        }
      })
    } else {
      previousNode = '';
      document.querySelector('.prev-btn').disabled = true;
      document.querySelector('.next-btn').disabled = true;
    }
  }

  function dragBlock(selector) {
    let element = document.querySelector(selector);

      element.onmousedown = function(e) {

      let coords = getCoords(element);
      let shiftX = e.pageX - coords.left;
      let shiftY = e.pageY - coords.top;

      element.style.zIndex = 1000; 

      function moveAt(e) {
        element.style.left = e.pageX - shiftX + 'px';
        element.style.top = e.pageY - shiftY + 'px';
      }

      document.onmousemove = function(e) {
        moveAt(e);
      };

      element.onmouseup = function() {
        document.onmousemove = null;
        element.onmouseup = null;
      };

    }

    element.ondragstart = function() {
      return false;
    };

    function getCoords(elem) {   // кроме IE8-
      let box = elem.getBoundingClientRect();
      return {
        top: box.top + pageYOffset,
        left: box.left + pageXOffset
      };
    }
  }

  function createElement(tag, props, ...children) {
    const element = document.createElement(tag);

    Object.keys(props).forEach(key => (element[key] = props[key]));

    children.forEach(child => {

      if (typeof child === "string") {
        child = document.createTextNode(child);
      }

      element.appendChild(child);
    });

    return element;
  }

  document.addEventListener("DOMContentLoaded", createApp);
}());

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdHMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6InNjcmlwdHMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgpIHtcclxuICBsZXQgaW5wdXRWYWx1ZSA9ICcnLFxyXG4gICAgc2VsZWN0ZWRFbGVtZW50ID0gJycsXHJcbiAgICBwcmV2aW91c05vZGUgPSAnJyxcclxuICAgIG5leHROb2RlID0gJycsXHJcbiAgICBwYXJlbnROb2RlID0gJycsXHJcbiAgICBjaGlsZHJlbk5vZGUgPSAnJztcclxuXHJcbiAgZnVuY3Rpb24gY3JlYXRlQXBwKCkge1xyXG4gICAgY29uc3QgaW5wdXRTZWFyY2ggPSBjcmVhdGVFbGVtZW50KCdpbnB1dCcsIHtjbGFzc05hbWU6ICdzZWFyY2gtaW5wdXQnLCB0eXBlOiAndGV4dCcsIHBsYWNlaG9sZGVyOiAnU2VsZWN0b3InfSk7XHJcbiAgICBjb25zdCBidG5TZWFyY2ggPSBjcmVhdGVFbGVtZW50KCdpbnB1dCcsIHtjbGFzc05hbWU6ICdzZWFyY2gtYnRuJywgdHlwZTogJ2J1dHRvbicsIHZhbHVlOiAnc2VhcmNoJ30pO1xyXG5cclxuICAgIGNvbnN0IGJ0blByZXYgPSBjcmVhdGVFbGVtZW50KCdpbnB1dCcsIHtjbGFzc05hbWU6ICdwcmV2LWJ0bicsIHR5cGU6ICdidXR0b24nLCB2YWx1ZTogJ1ByZXYnfSk7XHJcbiAgICBjb25zdCBidG5OZXh0ID0gY3JlYXRlRWxlbWVudCgnaW5wdXQnLCB7Y2xhc3NOYW1lOiAnbmV4dC1idG4nLCB0eXBlOiAnYnV0dG9uJywgdmFsdWU6ICdOZXh0J30pO1xyXG4gICAgY29uc3QgYnRuUGFyZW50ID0gY3JlYXRlRWxlbWVudCgnaW5wdXQnLCB7Y2xhc3NOYW1lOiAncGFyZW50LWJ0bicsIHR5cGU6ICdidXR0b24nLCB2YWx1ZTogJ1BhcmVudCd9KTtcclxuICAgIGNvbnN0IGJ0bkNoaWxkcmVuID0gY3JlYXRlRWxlbWVudCgnaW5wdXQnLCB7Y2xhc3NOYW1lOiAnY2hpbGRyZW4tYnRuJywgdHlwZTogJ2J1dHRvbicsIHZhbHVlOiAnQ2hpbGRyZW4nfSk7XHJcbiAgICBjb25zdCBidG5DbG9zZSA9IGNyZWF0ZUVsZW1lbnQoJ2lucHV0Jywge2NsYXNzTmFtZTogJ2Nsb3NlLWJ0bicsIHR5cGU6ICdidXR0b24nLCB2YWx1ZTogJ3gnfSk7XHJcblxyXG4gICAgY29uc3QgdGV4dEZpZWxkV3JhcHBlciA9IGNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtjbGFzc05hbWU6ICd0ZXh0LWZpZWxkLXdyYXBwZXInfSwgaW5wdXRTZWFyY2gsIGJ0blNlYXJjaCk7XHJcbiAgICBjb25zdCBidG5XcmFwcGVyID0gY3JlYXRlRWxlbWVudCgnZGl2Jywge2NsYXNzTmFtZTogJ2J0bi13cmFwcGVyJ30sIGJ0blByZXYsIGJ0bk5leHQsIGJ0blBhcmVudCwgYnRuQ2hpbGRyZW4sIGJ0bkNsb3NlKTtcclxuXHJcbiAgICBjb25zdCBtYWluQXBwV3JhcHBlciA9IGNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtjbGFzc05hbWU6ICdzZWFyY2gtYXBwLXdyYXBwZXInfSwgdGV4dEZpZWxkV3JhcHBlciwgYnRuV3JhcHBlcik7XHJcblxyXG4gICAgYnRuU2VhcmNoLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgIGJ0blByZXYuZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgYnRuTmV4dC5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICBidG5QYXJlbnQuZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgYnRuQ2hpbGRyZW4uZGlzYWJsZWQgPSB0cnVlO1xyXG5cclxuICAgIGJ0blNlYXJjaC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZVNlYXJjaCk7XHJcbiAgICBpbnB1dFNlYXJjaC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIGhhbmRsZUlucHV0KTtcclxuICAgIGJ0blBhcmVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZVBhcmVudCk7XHJcbiAgICBidG5DaGlsZHJlbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUNoaWxkcmVuKTtcclxuICAgIGJ0bk5leHQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVOZXh0KTtcclxuICAgIGJ0blByZXYuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVQcmV2aW91cyk7XHJcbiAgICBidG5DbG9zZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUNsb3NlKTtcclxuXHJcbiAgICBkb2N1bWVudC5ib2R5Lmluc2VydEFkamFjZW50RWxlbWVudCgnYmVmb3JlZW5kJywgbWFpbkFwcFdyYXBwZXIpO1xyXG5cclxuICAgIGRyYWdCbG9jaygnLnNlYXJjaC1hcHAtd3JhcHBlcicpO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgaGFuZGxlU2VhcmNoID0gKCkgPT4ge1xyXG4gICAgaW5wdXRWYWx1ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZWFyY2gtaW5wdXQnKS52YWx1ZTtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZWFyY2gtaW5wdXQnKS52YWx1ZSA9ICcnO1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNlYXJjaC1idG4nKS5kaXNhYmxlZCA9IHRydWU7XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKHNlbGVjdGVkRWxlbWVudCA9PT0gJycpIHtcclxuICAgICAgICBjb25zdCBzZWxlY3RlZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoaW5wdXRWYWx1ZSk7XHJcblxyXG4gICAgICAgIGlmIChzZWxlY3RlZCAhPT0gdW5kZWZpbmVkICYmIHNlbGVjdGVkICE9PSBudWxsKSB7XHJcbiAgICAgICAgICBzZWxlY3RlZEVsZW1lbnQgPSBzZWxlY3RlZDtcclxuICAgICAgICAgIHNlbGVjdGVkRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZC1lbGVtZW50LXNlYXJjaCcpO1xyXG4gICAgICAgICAgZmluZFJlbGF0aXZlKHNlbGVjdGVkRWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgaWYgKHNlbGVjdGVkRWxlbWVudCAhPT0gbnVsbCB8fCBzZWxlY3RlZEVsZW1lbnQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHNlbGVjdGVkRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3RlZC1lbGVtZW50LXNlYXJjaCcpO1xyXG4gICAgICAgIGNvbnN0IHNlbGVjdGVkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihpbnB1dFZhbHVlKTtcclxuXHJcbiAgICAgICAgaWYgKHNlbGVjdGVkICE9PSB1bmRlZmluZWQgJiYgc2VsZWN0ZWQgIT09IG51bGwpIHtcclxuICAgICAgICAgIHNlbGVjdGVkRWxlbWVudCA9IHNlbGVjdGVkO1xyXG4gICAgICAgICAgc2VsZWN0ZWRFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkLWVsZW1lbnQtc2VhcmNoJyk7XHJcbiAgICAgICAgICBmaW5kUmVsYXRpdmUoc2VsZWN0ZWRFbGVtZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGNhdGNoIChlcnIpIHtcclxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNlYXJjaC1idG4nKS5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcmV2LWJ0bicpLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5leHQtYnRuJykuZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGFyZW50LWJ0bicpLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNoaWxkcmVuLWJ0bicpLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2VhcmNoLWJ0bicpLmRpc2FibGVkID0gdHJ1ZTtcclxuXHJcbiAgICBzY3JvbGxUb0VsZW1lbnQoJy5zZWxlY3RlZC1lbGVtZW50LXNlYXJjaCcpO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGhhbmRsZUlucHV0ID0gKGUpID0+IHtcclxuICAgIChlLnRhcmdldC52YWx1ZSA9PT0gJycpXHJcbiAgICAgID8gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNlYXJjaC1idG4nKS5kaXNhYmxlZCA9IHRydWVcclxuICAgICAgOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2VhcmNoLWJ0bicpLmRpc2FibGVkID0gZmFsc2VcclxuICB9O1xyXG5cclxuICBjb25zdCBoYW5kbGVQYXJlbnQgPSAoKSA9PiB7XHJcbiAgICBoZWxwZXJGb3JIYW5kbGVyKHBhcmVudE5vZGUpO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGhhbmRsZUNoaWxkcmVuID0gKCkgPT4ge1xyXG4gICAgaGVscGVyRm9ySGFuZGxlcihjaGlsZHJlbk5vZGUpO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGhhbmRsZU5leHQgPSAoKSA9PiB7XHJcbiAgICBoZWxwZXJGb3JIYW5kbGVyKG5leHROb2RlKTtcclxuICB9O1xyXG5cclxuICBjb25zdCBoYW5kbGVQcmV2aW91cyA9ICgpID0+IHtcclxuICAgIGhlbHBlckZvckhhbmRsZXIocHJldmlvdXNOb2RlKTtcclxuICB9O1xyXG5cclxuICBjb25zdCBoYW5kbGVDbG9zZSA9ICgpID0+IHtcclxuICAgIGVsID0gJyc7XHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2VhcmNoLWFwcC13cmFwcGVyJykucmVtb3ZlKCk7XHJcbiAgICBzZWxlY3RlZEVsZW1lbnQgIT09ICcnID8gc2VsZWN0ZWRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkLWVsZW1lbnQtc2VhcmNoJykgOiBmYWxzZTtcclxuICB9O1xyXG5cclxuICBjb25zdCBoZWxwZXJGb3JIYW5kbGVyID0gKG5ld1NlbGVjdGVkKSA9PiB7XHJcbiAgICBzZWxlY3RlZEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0ZWQtZWxlbWVudC1zZWFyY2gnKTtcclxuICAgIHNlbGVjdGVkRWxlbWVudCA9IG5ld1NlbGVjdGVkO1xyXG4gICAgc2VsZWN0ZWRFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkLWVsZW1lbnQtc2VhcmNoJyk7XHJcblxyXG4gICAgZmluZFJlbGF0aXZlKHNlbGVjdGVkRWxlbWVudCk7XHJcbiAgICBzY3JvbGxUb0VsZW1lbnQoJy5zZWxlY3RlZC1lbGVtZW50LXNlYXJjaCcpO1xyXG4gIH07XHJcblxyXG4gIGZ1bmN0aW9uIHNjcm9sbFRvRWxlbWVudCh0aGVFbGVtZW50KSB7XHJcbiAgICBsZXQgc2VsZWN0ZWRQb3NYID0gMDtcclxuICAgIGxldCBzZWxlY3RlZFBvc1kgPSAwO1xyXG5cclxuICAgIGlmICh0eXBlb2YgdGhlRWxlbWVudCA9PT0gXCJzdHJpbmdcIikgdGhlRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhlRWxlbWVudCk7XHJcblxyXG4gICAgd2hpbGUgKHRoZUVsZW1lbnQgIT09IG51bGwpIHtcclxuICAgICAgc2VsZWN0ZWRQb3NYICs9IHRoZUVsZW1lbnQub2Zmc2V0TGVmdDtcclxuICAgICAgc2VsZWN0ZWRQb3NZICs9IHRoZUVsZW1lbnQub2Zmc2V0VG9wO1xyXG4gICAgICB0aGVFbGVtZW50ID0gdGhlRWxlbWVudC5vZmZzZXRQYXJlbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgc2VsZWN0ZWRQb3NZID0gc2VsZWN0ZWRQb3NZIC0gMjA7XHJcbiAgICB3aW5kb3cuc2Nyb2xsVG8oc2VsZWN0ZWRQb3NYLCBzZWxlY3RlZFBvc1kpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZmluZFJlbGF0aXZlKGVsZW1lbnQpIHtcclxuICAgIGNvbnN0IHRhZ05hbWVQYXJlbnQgPSBlbGVtZW50LnBhcmVudE5vZGUudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgY29uc3QgY2hpbGQgPSBlbGVtZW50LmNoaWxkcmVuWzBdO1xyXG4gICAgY29uc29sZS5sb2codGFnTmFtZVBhcmVudCk7XHJcbiAgICBpZiAoXHJcbiAgICAgIGVsZW1lbnQucGFyZW50Tm9kZSAhPT0gdW5kZWZpbmVkXHJcbiAgICAgICYmIHRhZ05hbWVQYXJlbnQgIT09ICdib2R5J1xyXG4gICAgICAmJiB0YWdOYW1lUGFyZW50ICE9PSAnaHRtbCdcclxuICAgICAgJiYgdGFnTmFtZVBhcmVudCAhPT0gJ2RvY3VtZW50J1xyXG4gICAgICAmJiB0YWdOYW1lUGFyZW50ICE9PSB1bmRlZmluZWRcclxuICAgICkge1xyXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGFyZW50LWJ0bicpLmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgIHBhcmVudE5vZGUgPSBlbGVtZW50LnBhcmVudE5vZGU7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBhcmVudC1idG4nKS5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgIHBhcmVudE5vZGUgPSAnJztcclxuICAgIH1cclxuXHJcbiAgICBpZiAoY2hpbGQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2hpbGRyZW4tYnRuJykuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgY2hpbGRyZW5Ob2RlID0gY2hpbGQ7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNoaWxkcmVuLWJ0bicpLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgY2hpbGRyZW5Ob2RlID0gJyc7XHJcbiAgICB9XHJcblxyXG4gICAgc2libGluZ0FyciA9IFtdLnNsaWNlLmNhbGwoZWxlbWVudC5wYXJlbnROb2RlLmNoaWxkcmVuKTtcclxuXHJcbiAgICBpZiAoc2libGluZ0Fyci5sZW5ndGggPiAxKSB7XHJcbiAgICAgIHNpYmxpbmdBcnIuZm9yRWFjaCgoaXRlbSwgaW5kZXgsIGFycikgPT4ge1xyXG5cclxuICAgICAgICBpZiAoaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoJ3NlbGVjdGVkLWVsZW1lbnQtc2VhcmNoJykpIHtcclxuXHJcbiAgICAgICAgICBpZiAoaW5kZXggPj0gMSkge1xyXG4gICAgICAgICAgICBwcmV2aW91c05vZGUgPSBhcnJbaW5kZXggLSAxXTtcclxuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByZXYtYnRuJykuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHByZXZpb3VzTm9kZSA9ICcnO1xyXG4gICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJldi1idG4nKS5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgaWYgKGluZGV4ID09PSBhcnIubGVuZ3RoIC0gMSkge1xyXG4gICAgICAgICAgICBuZXh0Tm9kZSA9ICcnO1xyXG4gICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubmV4dC1idG4nKS5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBuZXh0Tm9kZSA9IGFycltpbmRleCArIDFdO1xyXG4gICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubmV4dC1idG4nKS5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHByZXZpb3VzTm9kZSA9ICcnO1xyXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJldi1idG4nKS5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5uZXh0LWJ0bicpLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGRyYWdCbG9jayhzZWxlY3Rvcikge1xyXG4gICAgbGV0IGVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTtcclxuXHJcbiAgICAgIGVsZW1lbnQub25tb3VzZWRvd24gPSBmdW5jdGlvbihlKSB7XHJcblxyXG4gICAgICBsZXQgY29vcmRzID0gZ2V0Q29vcmRzKGVsZW1lbnQpO1xyXG4gICAgICBsZXQgc2hpZnRYID0gZS5wYWdlWCAtIGNvb3Jkcy5sZWZ0O1xyXG4gICAgICBsZXQgc2hpZnRZID0gZS5wYWdlWSAtIGNvb3Jkcy50b3A7XHJcblxyXG4gICAgICBlbGVtZW50LnN0eWxlLnpJbmRleCA9IDEwMDA7IFxyXG5cclxuICAgICAgZnVuY3Rpb24gbW92ZUF0KGUpIHtcclxuICAgICAgICBlbGVtZW50LnN0eWxlLmxlZnQgPSBlLnBhZ2VYIC0gc2hpZnRYICsgJ3B4JztcclxuICAgICAgICBlbGVtZW50LnN0eWxlLnRvcCA9IGUucGFnZVkgLSBzaGlmdFkgKyAncHgnO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBkb2N1bWVudC5vbm1vdXNlbW92ZSA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICBtb3ZlQXQoZSk7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBlbGVtZW50Lm9ubW91c2V1cCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGRvY3VtZW50Lm9ubW91c2Vtb3ZlID0gbnVsbDtcclxuICAgICAgICBlbGVtZW50Lm9ubW91c2V1cCA9IG51bGw7XHJcbiAgICAgIH07XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGVsZW1lbnQub25kcmFnc3RhcnQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiBnZXRDb29yZHMoZWxlbSkgeyAgIC8vINC60YDQvtC80LUgSUU4LVxyXG4gICAgICBsZXQgYm94ID0gZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICB0b3A6IGJveC50b3AgKyBwYWdlWU9mZnNldCxcclxuICAgICAgICBsZWZ0OiBib3gubGVmdCArIHBhZ2VYT2Zmc2V0XHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBjcmVhdGVFbGVtZW50KHRhZywgcHJvcHMsIC4uLmNoaWxkcmVuKSB7XHJcbiAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xyXG5cclxuICAgIE9iamVjdC5rZXlzKHByb3BzKS5mb3JFYWNoKGtleSA9PiAoZWxlbWVudFtrZXldID0gcHJvcHNba2V5XSkpO1xyXG5cclxuICAgIGNoaWxkcmVuLmZvckVhY2goY2hpbGQgPT4ge1xyXG5cclxuICAgICAgaWYgKHR5cGVvZiBjaGlsZCA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgIGNoaWxkID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoY2hpbGQpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBlbGVtZW50LmFwcGVuZENoaWxkKGNoaWxkKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBlbGVtZW50O1xyXG4gIH1cclxuXHJcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgY3JlYXRlQXBwKTtcclxufSgpKTtcclxuIl19
